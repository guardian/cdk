<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@guardian/cdk - v25.1.0</title>
	<meta name="description" content="Documentation for @guardian/cdk - v25.1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@guardian/cdk - v25.1.0</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>@guardian/cdk - v25.1.0</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#general-usage-for-guardiancdk" id="general-usage-for-guardiancdk" style="color: inherit; text-decoration: none;">
					<h1>General Usage for @guardian/cdk</h1>
				</a>
				<a href="#üñ•-installation" id="üñ•-installation" style="color: inherit; text-decoration: none;">
					<h2>üñ• Installation</h2>
				</a>
				<p>This library can be installed from <a href="https://www.npmjs.com/package/@guardian/cdk">NPM</a>.</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> --</span><span style="color: #001080">save</span><span style="color: #000000"> @</span><span style="color: #001080">guardian</span><span style="color: #000000">/</span><span style="color: #001080">cdk</span>
</code></pre>
				<p>or</p>
				<pre><code><span style="color: #001080">yarn</span><span style="color: #000000"> </span><span style="color: #001080">add</span><span style="color: #000000"> @</span><span style="color: #001080">guardian</span><span style="color: #000000">/</span><span style="color: #001080">cdk</span>
</code></pre>
				<p>We recommend using TypeScript with <code>@guardian/cdk</code> as type safety is wonderful!</p>
				<a href="#üèü-patterns" id="üèü-patterns" style="color: inherit; text-decoration: none;">
					<h2>üèü Patterns</h2>
				</a>
				<p>Patterns are high level classes which compose a number of constructs to produce standard architectures.</p>
				<p>For example, you should be able to get all the resources you need to deploy a new lambda function from one <code>GuLambdaStack</code> class.</p>
				<p>Patterns should be your default entry point to this library and can be found <a href="../src/patterns">here</a>.</p>
				<a href="#üèó-constructs" id="üèó-constructs" style="color: inherit; text-decoration: none;">
					<h2>üèó Constructs</h2>
				</a>
				<p>Constructs are lower level classes which will create one or more resources to produce one element of a stack.</p>
				<p>For example, the <code>GuDatabaseInstance</code> will create an RDS instance as well as a parameter group, if required.
				This library defines a number of constructs which are combined to create the higher level patterns.</p>
				<p>If there is a pattern available for your use case, prefer to use that over composing constructs yourself.
				We welcome feedback and/or PRs to extend the functionality of patterns.</p>
				<p>Where you need to do something outside currently available patterns, you can use the constructs to provide some level of abstraction.
				In this case, consider whether it&#39;s worth defining a pattern.</p>
				<a href="#using-patterns-and-constructs" id="using-patterns-and-constructs" style="color: inherit; text-decoration: none;">
					<h2>Using patterns and constructs</h2>
				</a>
				<p>Patterns can be imported from the top level of the library:</p>
				<pre><code class="language-typescript"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">GuScheduledLambda</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@guardian/cdk&quot;</span><span style="color: #000000">;</span>
</code></pre>
				<p>While constructs must be imported from their construct directory:</p>
				<pre><code class="language-typescript"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">GuAutoScalingGroup</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;@guardian/cdk/lib/constructs/autoscaling&quot;</span><span style="color: #000000">;</span>
</code></pre>
				<a href="#‚òÅÔ∏è-aws-library-versions" id="‚òÅÔ∏è-aws-library-versions" style="color: inherit; text-decoration: none;">
					<h2>‚òÅÔ∏è AWS Library Versions</h2>
				</a>
				<p>Any versions of the <code>@aws-cdk</code> libraries that you have installed in your project must be the same version as those used in the <code>@guardian/cdk</code> library.</p>
				<a href="#ü™°-synthesising" id="ü™°-synthesising" style="color: inherit; text-decoration: none;">
					<h2>ü™° Synthesising</h2>
				</a>
				<p>The <code>cdk synth</code> command can be used to generate cloudformation from CDK definitions.
				This will, by default, generate JSON in the <code>cdk.out</code> directory.</p>
				<p>We recommend using TypeScript with <code>@guardian/cdk</code> as type safety is wonderful!</p>
				<p>This does, however require the use of <code>ts-node</code> to compile on the fly. This can be done in two ways:</p>
				<ol>
					<li>Setting the <code>app</code> property in the <code>cdk.json</code> configuration file</li>
					<li>Passing the <code>app</code> flag to <code>cdk</code>. For example <code>cdk synth --app=&quot;ts-node ./bin/my-app.ts&quot;</code></li>
				</ol>
				<a href="#synthesising-as-yaml" id="synthesising-as-yaml" style="color: inherit; text-decoration: none;">
					<h3>Synthesising as YAML</h3>
				</a>
				<p>For apps with a single stack, the generated YAML will also be printed in the console.
				You can pipe this to disk:</p>
				<pre><code class="language-bash"><span style="color: #000000">cdk synth --app=</span><span style="color: #A31515">&quot;ts-node ./bin/my-app.ts&quot;</span><span style="color: #000000"> &gt; cloudformation.yaml</span>
</code></pre>
				<p>For app with multiple stacks, you can specify a stack to see the YAML output.</p>
				<a href="#üß™-testing" id="üß™-testing" style="color: inherit; text-decoration: none;">
					<h2>üß™ Testing</h2>
				</a>
				<p>It is recommended to set up <a href="https://jestjs.io/docs/snapshot-testing">Jest snapshot testing</a> for your stack and have the test run during CI.</p>
				<p>Snapshot tests allow you to very quickly see the changes that will be made to the generated template.
				This is especially useful when upgrading the version of <code>@guardian/cdk</code>.</p>
				<a href="#üÜô-upgrading" id="üÜô-upgrading" style="color: inherit; text-decoration: none;">
					<h2>üÜô Upgrading</h2>
				</a>
				<p>The <code>@guardian/cdk</code> library follows Semantic Versioning.</p>
				<p>If you have snapshot testing set up and running in CI, you should feel comfortable updating to any patch or minor release.
				You can use dependabot to automate this.</p>
				<p>By default, automatic version upgrade PRs will fail their snapshot tests.
				This is because <code>@guardian/cdk</code> adds a tracking tag (<code>gu:cdk:version</code>) to resources with the version number of the library.</p>
				<p>To reduce friction, <code>@guardian/cdk</code> ships a mock that can be used with Jest, which results in snapshots having a static value for this tag.</p>
				<a href="#üÉè-mocking-gucdkversion" id="üÉè-mocking-gucdkversion" style="color: inherit; text-decoration: none;">
					<h3>üÉè Mocking <code>gu:cdk:version</code></h3>
				</a>
				<p>We recommend setting up a global Jest mock for <code>gu:cdk:version</code>.
				This can be done with a few config changes.</p>
				<p>First, create <code>jest.setup.js</code> and add the global mock:</p>
				<pre><code class="language-javascript"><span style="color: #001080">jest</span><span style="color: #000000">.</span><span style="color: #795E26">mock</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;@guardian/cdk/lib/constants/tracking-tag&quot;</span><span style="color: #000000">);</span>
</code></pre>
				<p>Next, edit <code>jest.config.js</code> setting the <a href="https://jestjs.io/docs/configuration#setupfilesafterenv-array"><code>setupFilesAfterEnv</code></a> property:</p>
				<pre><code class="language-javascript"><span style="color: #267F99">module</span><span style="color: #000000">.</span><span style="color: #267F99">exports</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">setupFilesAfterEnv:</span><span style="color: #000000"> [</span><span style="color: #A31515">&quot;./jest.setup.js&quot;</span><span style="color: #000000">],</span>
<span style="color: #000000">};</span>
</code></pre>
				<p>Finally, update your snapshots. The <code>gu:cdk:version</code> tag should now be:</p>
				<pre><code class="language-jsonc"><span style="color: #000000">{</span>
<span style="color: #000000">  </span><span style="color: #0451A5">&quot;Key&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;gu:cdk:version&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #0451A5">&quot;PropagateAtLaunch&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">true</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #0451A5">&quot;Value&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TEST&quot;</span><span style="color: #000000">, </span><span style="color: #008000">// &lt;-- would otherwise be the version number of @guardian/cdk in use</span>
<span style="color: #000000">}</span>
</code></pre>
				<p>Note: This only affects tests. The <code>gu:cdk:version</code> tag in the final template created from a <code>cdk synth</code> will have the correct value.</p>
				<p>‚ú® With <code>gu:cdk:version</code> mocked, snapshot tests run during CI and dependabot automatically raising PRs to update <code>@guardian/cdk</code>,
				once CI passes, you can confidently merge PRs to adopt the AWS best practices encoded in <code>@guardian/cdk</code> ‚ú®.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constants.html">constants</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_acm.html">constructs/acm</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_autoscaling.html">constructs/autoscaling</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_cloudwatch.html">constructs/cloudwatch</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_core.html">constructs/core</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_ec2.html">constructs/ec2</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_iam.html">constructs/iam</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_kinesis.html">constructs/kinesis</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_lambda.html">constructs/lambda</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_loadbalancing.html">constructs/loadbalancing</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_rds.html">constructs/rds</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_s3.html">constructs/s3</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constructs_sns.html">constructs/sns</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils_ec2.html">utils/ec2</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils_lambda.html">utils/lambda</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils_mixin.html">utils/mixin</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils_security_groups.html">utils/security-<wbr>groups</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils_test.html">utils/test</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>